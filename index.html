<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Xat Matrix Frame</title>
    <style>
        /* ==========================================
         * VARIABLES Y DISEÑO BASE
         * ========================================== */
        :root {
            --bg-top: #020417;
            --bg-bottom: #102B6E;
            --vignette-color: #020417;
            --glow-color: #6FE3FF;
            --header-padding: 65px; /* Espacio para el banner superior invisible */
        }

        html {
            width: 100%;
            height: 100%;
            background: var(--bg-top);
            background: linear-gradient(to bottom, var(--bg-top) 0%, var(--bg-bottom) 100%);
            background-attachment: fixed;
        }

        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            padding-top: var(--header-padding);
            box-sizing: border-box;
            overflow: hidden; 
            font-family: 'Courier New', Consolas, monospace;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* ==========================================
         * LIENZOS DUALES (Efecto Matrix Auténtico)
         * ========================================== */
        .matrix-canvas {
            position: fixed;
            top: 0;
            left: 0;
            display: block;
            width: 100%;
            height: 100%;
        }

        #trailCanvas {
            z-index: 1; /* Estelas de fondo */
        }

        #headCanvas {
            z-index: 2; /* Cabezas brillantes siempre nítidas al frente */
        }

        /* ==========================================
         * EFECTOS CINEMATOGRÁFICOS Y UI (OVERLAYS)
         * ========================================== */
        .vignette {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 50% 50%, transparent 20%, var(--vignette-color) 150%);
            z-index: 10;
            pointer-events: none;
        }

        .scanlines {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, transparent 50%, rgba(0, 0, 0, 0.2) 50%);
            background-size: 100% 4px;
            z-index: 11;
            pointer-events: none;
            opacity: 0.6;
        }

        /* ==========================================
         * UI ADICIONAL (SWITCHER)
         * ========================================== */
        .theme-switcher {
            position: fixed;
            top: calc(var(--header-padding) + 20px);
            right: 25px;
            z-index: 101;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #theme-toggle-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: all 0.4s ease;
            background: var(--glow-color);
            box-shadow: 0 0 15px var(--glow-color);
            outline: none;
            padding: 0;
            position: relative;
        }

        #theme-toggle-btn:active {
            transform: scale(0.9);
        }

        #theme-toggle-btn::after {
            content: '';
            position: absolute;
            top: -5px; left: -5px; right: -5px; bottom: -5px;
            border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.8; }
            100% { transform: scale(1.5); opacity: 0; }
        }

        @media (max-width: 768px) {
            :root { --header-padding: 50px; }
            #theme-toggle-btn { width: 38px; height: 38px; }
        }

    </style>
</head>
<body>

    <!-- Capas de efectos superpuestas -->
    <div class="vignette"></div>
    <div class="scanlines"></div>
    
    <!-- Selector de Temas (Círculo Único) -->
    <div class="theme-switcher">
        <button id="theme-toggle-btn" onclick="rotateTheme()" title="Cambiar color Matrix"></button>
    </div>

    <!-- Lienzos de renderizado Dual Matrix -->
    <canvas id="trailCanvas" class="matrix-canvas"></canvas>
    <canvas id="headCanvas" class="matrix-canvas"></canvas>

    <script>
        /**
         * ==========================================
         * CONFIGURACIÓN CORE Y VARIABLES
         * ==========================================
         */
        // Sistema de Doble Lienzo para evitar que las letras brillantes se desvanezcan prematuramente
        const trailCanvas = document.getElementById('trailCanvas');
        const trailCtx = trailCanvas.getContext('2d');
        
        const headCanvas = document.getElementById('headCanvas');
        const headCtx = headCanvas.getContext('2d');

        let width = window.innerWidth;
        let height = window.innerHeight;
        let columns = [];
        let isMobile = width <= 768; 

        const THEMES = {
            blue: {
                trail: '#1FA3C6', glow: '#6FE3FF', glitch: 'rgba(111, 227, 255, 0.9)', xatWord: '#FFFFFF', head: 'rgba(255, 255, 255, 0.8)',
                bgTop: '#020417', bgBottom: '#102B6E', vignette: '#020417'
            },
            green: {
                trail: '#00FF41', glow: '#8FFF8F', glitch: 'rgba(143, 255, 143, 0.9)', xatWord: '#FFFFFF', head: 'rgba(255, 255, 255, 0.8)',
                bgTop: '#000B00', bgBottom: '#002B00', vignette: '#000B00'
            },
            yellow: {
                trail: '#FFC107', glow: '#FFE082', glitch: 'rgba(255, 224, 130, 0.9)', xatWord: '#FFFFFF', head: 'rgba(255, 255, 255, 0.8)',
                bgTop: '#0F0B00', bgBottom: '#332600', vignette: '#0F0B00'
            },
            purple: {
                trail: '#B026FF', glow: '#E08FFF', glitch: 'rgba(224, 143, 255, 0.9)', xatWord: '#FFFFFF', head: 'rgba(255, 255, 255, 0.8)',
                bgTop: '#0A0011', bgBottom: '#220033', vignette: '#0A0011'
            }
        };

        const themeOrder = ['blue', 'green', 'yellow', 'purple'];
        let currentTheme = localStorage.getItem('matrixTheme') || 'blue';
        let activeColors = THEMES[currentTheme];

        function rotateTheme() {
            let nextIndex = (themeOrder.indexOf(currentTheme) + 1) % themeOrder.length;
            setTheme(themeOrder[nextIndex]);
        }

        function setTheme(themeName) {
            currentTheme = themeName;
            activeColors = THEMES[themeName];
            localStorage.setItem('matrixTheme', themeName);

            document.documentElement.style.setProperty('--bg-top', activeColors.bgTop);
            document.documentElement.style.setProperty('--bg-bottom', activeColors.bgBottom);
            document.documentElement.style.setProperty('--vignette-color', activeColors.vignette);
            document.documentElement.style.setProperty('--glow-color', activeColors.glow);

            const btn = document.getElementById('theme-toggle-btn');
            if (btn) {
                btn.style.background = activeColors.trail;
                btn.style.boxShadow = `0 0 15px ${activeColors.glow}`;
            }

            // Limpiamos ambos lienzos al cambiar de tema
            if (trailCtx && headCtx && isFinite(width) && isFinite(height)) {
                trailCtx.clearRect(0, 0, width, height);
                headCtx.clearRect(0, 0, width, height);
            }
        }

        const CHARS = 'ｱｲｳｴｵｶｷｸｹｺｻｼｽｾｿﾀﾁﾂﾃﾄﾅﾆﾇﾈﾉﾊﾋﾌﾍﾎﾏﾐﾑﾒﾓﾔﾕﾖﾗﾘﾙﾚﾛﾜﾝ0123456789<>/-+=*#@';

        class Column {
            constructor(x, fontSize) {
                this.x = x;
                this.fontSize = fontSize;
                this.y = (Math.random() * 2 - 1) * height; 
                this.prevY = this.y;
                
                // Velocidad equilibrada: Lenta y relajante, pero constante.
                const baseSpeed = this.fontSize * 0.08; 
                this.speed = baseSpeed + (Math.random() * baseSpeed * 0.5);
                
                this.targetWord = "XAT.COM";
                this.wordIndex = -1;
                this.isHighlight = false;
                this.text = this.getRandomChar();
            }

            getRandomChar() {
                return CHARS.charAt(~~(Math.random() * CHARS.length));
            }

            draw(trailCtx, headCtx) {
                this.y += this.speed;
                let currentRow = ~~(this.y / this.fontSize);
                let prevRow = ~~(this.prevY / this.fontSize);

                // 1. DIBUJAR CABEZA (Siempre nítida, se dibuja cada frame en el canvas superior)
                headCtx.font = `bold ${this.fontSize}px 'MS Gothic', monospace`;
                headCtx.textAlign = 'center';

                if (this.isHighlight) {
                    headCtx.fillStyle = activeColors.xatWord;
                    headCtx.shadowColor = activeColors.glow;
                    headCtx.shadowBlur = isMobile ? 5 : 15;
                } else {
                    headCtx.fillStyle = activeColors.head;
                    headCtx.shadowColor = activeColors.glow;
                    headCtx.shadowBlur = isMobile ? 3 : 12;
                    if(Math.random() < 0.1) {
                        headCtx.fillStyle = '#FFFFFF';
                        headCtx.shadowBlur = isMobile ? 8 : 20;
                    }
                }
                headCtx.fillText(this.text, this.x, currentRow * this.fontSize);

                // 2. LOGICA DE ESTELA (Sólo se dibuja cuando la cabeza avanza de fila)
                if (currentRow > prevRow) {
                    trailCtx.font = `bold ${this.fontSize}px 'MS Gothic', monospace`;
                    trailCtx.textAlign = 'center';

                    if (this.isHighlight) {
                        trailCtx.fillStyle = activeColors.xatWord;
                        trailCtx.shadowColor = activeColors.glow;
                        trailCtx.shadowBlur = isMobile ? 5 : 10; 
                    } else {
                        trailCtx.fillStyle = activeColors.trail;
                        trailCtx.shadowBlur = 0;
                    }
                    // Imprime la estela en la posición anterior
                    trailCtx.fillText(this.text, this.x, prevRow * this.fontSize);

                    // Actualiza el texto para la siguiente fila
                    if (this.wordIndex >= 0 && this.wordIndex < this.targetWord.length) {
                        this.text = this.targetWord[this.wordIndex];
                        this.isHighlight = true;
                        this.wordIndex++;
                        if (this.wordIndex >= this.targetWord.length) this.wordIndex = -1;
                    } else {
                        this.text = this.getRandomChar();
                        this.isHighlight = false;
                        if (Math.random() < 0.002) this.wordIndex = 0;
                    }
                    this.prevY = this.y;
                }

                // 3. EFECTO GLITCH EN LA ESTELA (Cambio aleatorio de letras previas)
                if (Math.random() < 0.03 && currentRow > 5) {
                    let glitchRow = currentRow - ~~(Math.random() * 10) - 1;
                    trailCtx.font = `bold ${this.fontSize}px 'MS Gothic', monospace`;
                    trailCtx.textAlign = 'center';
                    trailCtx.fillStyle = activeColors.glitch;
                    trailCtx.shadowBlur = 0;
                    trailCtx.fillText(this.getRandomChar(), this.x, glitchRow * this.fontSize);
                }

                // Reseteo al llegar al fondo
                if (this.y > height + 100 && Math.random() > 0.95) {
                    this.y = 0;
                    this.prevY = 0;
                    this.wordIndex = -1;
                    this.isHighlight = false;
                }
            }
        }

        function initMatrix() {
            width = window.innerWidth;
            height = window.innerHeight;
            trailCanvas.width = headCanvas.width = width;
            trailCanvas.height = headCanvas.height = height;
            isMobile = width <= 768; 
            columns = [];

            let currentX = 0;
            while (currentX < width) {
                let sizeCategory = Math.random();
                let fontSize = sizeCategory < 0.2 ? 12 : (sizeCategory < 0.8 ? 18 : 26);
                
                // Densidad Alta: Se superponen las columnas inteligentemente
                currentX += isMobile ? fontSize * 0.9 : fontSize * 0.55;
                columns.push(new Column(currentX - (fontSize/2), fontSize));
            }
            columns.sort((a, b) => a.fontSize - b.fontSize);
        }

        function animate() {
            // Desvanece LENTAMENTE el canvas de las estelas para dejar el rastro clásico
            trailCtx.globalCompositeOperation = 'destination-out';
            trailCtx.fillStyle = `rgba(0, 0, 0, ${isMobile ? 0.05 : 0.03})`; 
            trailCtx.fillRect(0, 0, width, height);
            trailCtx.globalCompositeOperation = 'source-over';
            
            // Borra POR COMPLETO el canvas de las cabezas cada frame (mantiene el brillo intacto)
            headCtx.clearRect(0, 0, width, height);

            for (let i = 0; i < columns.length; i++) {
                columns[i].draw(trailCtx, headCtx);
            }
            requestAnimationFrame(animate);
        }

        window.addEventListener('resize', () => {
            initMatrix();
            trailCtx.clearRect(0, 0, width, height);
            headCtx.clearRect(0, 0, width, height);
        });

        initMatrix(); 
        setTheme(currentTheme); 
        animate(); 

        // ==========================================
        // PROTECCIÓN CONTRA CLICK DERECHO Y F12
        // ==========================================
        document.addEventListener('contextmenu', e => e.preventDefault());

        document.addEventListener('keydown', function(e) {
            if (e.key === 'F12' || e.keyCode === 123) {
                e.preventDefault(); return false;
            }
            if (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'i' || e.key === 'J' || e.key === 'j')) {
                e.preventDefault(); return false;
            }
            if (e.ctrlKey && (e.key === 'U' || e.key === 'u')) {
                e.preventDefault(); return false;
            }
        });

    </script>
</body>
</html>


